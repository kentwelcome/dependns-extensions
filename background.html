<html>
	<!--<script type="text/javascript"  src="js/gears_init.js"></script> -->
	<script type="text/javascript"  src="js/Match.js"></script>
	<script type="text/javascript"  src="js/ArrayList.js"></script>
	<script type="text/javascript"  src="js/Integer.js"></script>
	<script type="text/javascript"  src="js/String.js"></script>
	<script type="text/javascript"  src="js/Answer.js"></script>
	<script type="text/javascript"  src="js/AnswerIP.js"></script>
	<script type="text/javascript"  src="js/Match.js"></script>
	<script type="text/javascript"  src="js/IPChoice.js"></script>
	<script type="text/javascript"  src="js/DNSLookup.js"></script>
	<script type="text/javascript"  src="js/Response.js"></script>
	<script type="text/javascript"  src="js/Response.js"></script>
	<script type="text/javascript"  src="js/HistoryLookup.js"></script>
	<script>
		function display( str )
		{
			//alert(str);
			return null;
		}

		var DepenDNS = {
			start: function() {
				//this.baseurl = chrome.i18n.getMessage("baseurl");
				this.ips = [];
				this.count = 0;
				
			},
			get_domain_from_url: function(url) {
				return  url.match(/:\/\/(.[^/]+)/)[1]
			},
			run: function(tab) {
				this.count++;
				var domain = this.get_domain_from_url(tab.url);
				var count_string = this.count + '';
				var dnslookup = new DNSLookup();
				count_string = dnslookup.dodebug()/10 + '';
				chrome.browserAction.setBadgeBackgroundColor( {color:[208, 0, 24, 255]} );
				chrome.browserAction.setIcon({path: "icon/icon_22.png"});
				this.badge(count_string,tab);
			},
			badge: function(text,tab) {
				var obj = new Object();
				obj.text = text;
				obj.tabId = tab.id;
				chrome.browserAction.setBadgeText(obj);
			},

		};  // end of DepenDNS  
		DepenDNS.start();
		websql();
		//testArrayList();	
		chrome.tabs.onSelectionChanged.addListener(function(tabid,selectedInfo){
			chrome.tabs.get(tabid,function(tab) {
				DepenDNS.run(tab);
			});
		});

		chrome.windows.onFocusChanged.addListener(function(windowId) {
			chrome.tabs.getSelected(windowId, function(tab) {
				DepenDNS.run(tab);
			});
		});


		chrome.tabs.onUpdated.addListener(function(tabId, change, ttab) {
			// make sure the tab hasn't changed...
			chrome.tabs.getSelected(null, function(tab) {
				DepenDNS.run(tab);
			});
		});

		function displayMyResult(rs)
		{
			alert(rs);
		};

		function displayMyError(err)
		{
			alert(err);
		};

		var db;
		function websql(){
			var success = false;
			try{
				db = window.openDatabase("dependns", "1.1", "DepenDNS History Database",  1024 * 1024);	
				if( !db )
					alert('Could not create database: ');
			}
			catch (ex){
				alert('Could not create database: ' + ex.message);
			}

			// execute sql
			/*db.transaction(function(tx) 
			{    
				tx.executeSql('', 
				[ selectedCategory ], 
				function (tx, rs) { displayMyResult(rs); }, 
				function (tx, err) { displayMyError(err); } );
			});*/
			/*if (window.google && google.gears) {

				try {
					db = google.gears.factory.create('beta.database');
					if (db) {
						db.open('database-DepenDNS');
						db.execute('create table if not exists DepenDNS' +
						' (Phrase varchar(255), Timestamp int)');

						success = true;
						// Initialize the UI at startup.
						displayRecentPhrases();
					}
				}
				catch (ex) {
					alert('Could not create database: ' + ex.message);
				}
			}*/
		};

		
	</script>
	<!-- <body onload="init()">
		<img id="icon" src="/icon/icon_22.png">
		<canvas id="canvas" width="22" height="22">
	</body> -->
</html>



